# DevOps QA 傾向分析

## 手順

以下の手順で実行する。

1. uv run python -m tag_extractor --files data/DevOps-QAs.csv --column 要約 --output data/devops_tags.json
2. src/tag_extractor/prompt.mdのタスクをあなた自身で実行してください。対象タグ候補はdata/devops_tags.jsonです。結果はdata/tags.jsonに書き込んでください。
3. uv run python -m tag_assigner --tags data/tags.json --csv data/DevOps-QAs.csv --output data/tagged_devops.csv --column 要約 --semantic --batch-size 256 --progress
4. uv run python -m tag_analyzer --csv data/tagged_devops.csv --output reports/devops_tag_report.md --date-column 作成日 --date-format "%d/%m/%y %I:%M %p" --freq W --top-n 6

## 各ステップの処理内容

### 1. タグ候補抽出 (`tag_extractor`)

- **処理内容**: CSVの要約列から日本語テキストを形態素解析でトークン化
- **AI処理**: SentenceTransformerを使用してトークンをベクトル埋め込みに変換し、意味的クラスタリング（KMeans）で自動分類
- **出力**: 意味クラスタごとの候補語リストをJSONファイルで生成

### 2. タグ体系設計 (AIエージェント手動作業)

- **処理内容**: 機械的に抽出された候補語を人間が理解しやすい分類体系に整理
- **AI処理**: 類似語の統合、表記ゆれの正規化、階層的なタグ名とタグ値の設計
- **出力**: 「タグ名」と「タグの値」の組み合わせからなる分類定義をJSONで作成

### 3. タグ自動付与 (`tag_assigner`)

- **処理内容**: 設計されたタグ定義を使用して、各チケットの要約文に適切なタグを自動付与
- **AI処理**: セマンティック検索（SentenceTransformer）でタグ値と要約文の意味的類似度を計算し、閾値（0.35）以上の類似度を持つタグを最大3個まで付与
- **出力**: 元のCSVにタグ付与結果列を追加した新しいCSVファイル

### 4. 傾向分析・可視化 (`tag_analyzer`)

- **処理内容**: タグ付きデータから時系列トレンドとカテゴリ別分布を統計分析
- **データ処理**: 日付解析、週次集計、上位N件の抽出、matplotlib/seabornによる自動グラフ生成
- **出力**: Markdownレポートと可視化グラフ（PNG画像）の生成

## 処理フロー

```text
┌─────────────────────┐
│ data/DevOps-QAs.csv │ (入力データ)
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   tag_extractor     │ (AI: 埋め込み+クラスタリング)
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│data/devops_tags.json│ (候補語リスト)
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   AIエージェント     │ (AI: 分類体系設計)
│  タグ体系設計       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   data/tags.json    │ (タグ定義)
└──────────┬──────────┘
           │         ┌─────────────────────┐
           │         │ data/DevOps-QAs.csv │ (元データ再利用)
           │         └──────────┬──────────┘
           │                    │
           └────────────────────┼──────┐
                                │      │
                                ▼      ▼
                        ┌─────────────────────┐
                        │   tag_assigner      │ (AI: セマンティック検索)
                        └──────────┬──────────┘
                                   │
                                   ▼
                        ┌─────────────────────┐
                        │data/tagged_devops.csv│ (タグ付きデータ)
                        └──────────┬──────────┘
                                   │
                                   ▼
                        ┌─────────────────────┐
                        │   tag_analyzer      │ (統計処理+可視化)
                        └──────────┬──────────┘
                                   │
                     ┌─────────────┴─────────────┐
                     │                           │
                     ▼                           ▼
          ┌─────────────────────┐    ┌─────────────────────┐
          │devops_tag_report.md │    │ reports/figs/*.png  │
          │      (レポート)       │    │    (グラフ画像)     │
          └─────────────────────┘    └─────────────────────┘
```

## 技術詳細（開発者・研究者向け）

### AI処理アルゴリズムの詳細

#### 1. タグ候補抽出のトークン化とクラスタリング

**トークン化プロセス:**

- 正規表現による日本語文字（ひらがな・カタカナ・漢字）の抽出：`[\u3040-\u30FF\u4E00-\u9FFF]{2,20}`
- ASCII文字（英数字）のトークン化：`\b[A-Za-z][A-Za-z0-9.+_-]{1,}\b`
- ノイズ除去パターンの適用（数字のみの文字列など）
- Unicode正規化（NFKC）による文字統一と重複排除

**埋め込みとクラスタリング:**

- **モデル**: `paraphrase-multilingual-MiniLM-L12-v2`（多言語対応の軽量SentenceTransformer）
- **ベクトル化**: 各トークンを384次元のベクトル空間に埋め込み、コサイン類似度計算に最適化
- **クラスタリング**: K-Meansアルゴリズムでクラスタ数を自動決定（√(N/2)の経験則、最大10クラスタ）
- **正規化**: L2正規化により埋め込みベクトルの大きさを統一し、意味的類似度の精度を向上

#### 2. セマンティック検索によるタグ自動付与

**セマンティック検索プロセス:**

- **同一モデル使用**: tag_extractorと同じ`paraphrase-multilingual-MiniLM-L12-v2`で一貫性を保持
- **バッチ処理**: 256件ずつバッチ処理でGPUメモリ使用量を最適化
- **類似度計算**: コサイン類似度でタグ値と要約文の意味的関連性を0.0-1.0のスコアで評価

**タグ付与ロジック:**

- **閾値フィルタリング**: 類似度0.35以上のタグのみ採用（経験的に最適化された値）
- **上位K選択**: カテゴリごとに最大3個のタグを類似度順で選択
- **重複排除**: 同一カテゴリ内で意味が重複するタグを自動除外
- **バランス調整**: 全カテゴリから均等にタグが選ばれるよう調整機能

